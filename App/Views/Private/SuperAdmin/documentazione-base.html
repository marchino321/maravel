{% extends 'layout.html' %}
{% block title %}{{ Titolo }}{% endblock %}

{% block Body %}
<style>
  .sticky-toc {
    position: fixed;
    top: 94px;
    left: 250px;
    width: 400px;
    height: calc(100vh - 160px);
    overflow-y: auto;
  }

  .toc {
    list-style: none;
    padding-left: 0;
  }

  .toc li {
    margin-bottom: 6px;
  }

  .toc li a {
    text-decoration: none;
    display: block;
    padding: 6px 8px;
    border-radius: 4px;
  }

  .toc li a:hover {
    background: #f0f0f0;
  }

  .toc ul {
    padding-left: 15px;
    margin-top: 4px;
  }
</style>

<div class="row">

  <!-- ========================= -->
  <!-- üìå TOC SINISTRA -->
  <!-- ========================= -->
  <div class="col-md-3">
    <div class="card ombra sticky-toc">
      <div class="card-body">
        <ul class="toc">
          <li><a href="#intro">Panoramica</a></li>
          <li><a href="#struttura">1. Struttura Base</a></li>
          <li><a href="#bootstrap">2. Bootstrap & Config</a></li>
          <li><a href="#router">3. Router</a></li>
          <li><a href="#twig">4. Twig & Template</a></li>
          <li><a href="#assets">5. Gestione Assets</a></li>
          <li><a href="#formhelper">6. FormHelper</a></li>
          <li><a href="#ajax">7. AJAX & Forms</a></li>
          <li><a href="#plugin">8. Plugin System</a></li>
          <li><a href="#update">9. Update & Backup</a></li>
          <li><a href="#migrations">10. Migrazioni DB</a></li>
          <li><a href="#install">11. Installazione Sistema</a></li>
          <li><a href="#eventi-core">12. Eventi Core</a></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- ========================= -->
  <!-- üìñ CONTENUTI -->
  <!-- ========================= -->
  <div class="col-md-9">

    <!-- ========================= -->
    <!-- INTRO -->
    <!-- ========================= -->
    <div class="card ombra" id="intro">
      <div class="card-body">
        <h3>üìò Documentazione Framework Gestionale</h3>
        <ul>
          <li><b>Versione:</b> RELEASE v1.0</li>
          <li><b>Build:</b> {{ "now"|date("d-m-Y H:i") }}</li>
          <li><b>Ambiente:</b> {{ env is defined ? env : "dev" }}</li>
        </ul>
        <p class="mt-3">
          Questa pagina rappresenta la <b>documentazione tecnica ufficiale</b>
          del framework e il riferimento per installazione, sviluppo e manutenzione.
        </p>
      </div>
    </div>

    <!-- ========================= -->
    <!-- STRUTTURA -->
    <!-- ========================= -->
    <div class="card ombra mt-3" id="struttura">
      <div class="card-body">
        <h3>1) Struttura Base</h3>
        <pre><code>public_html/
‚îú‚îÄ App/
‚îÇ   ‚îú‚îÄ Controllers/
‚îÇ   ‚îú‚îÄ Plugins/
‚îÇ   ‚îî‚îÄ Views/
‚îú‚îÄ Core/
‚îÇ   ‚îú‚îÄ Classi/
‚îÇ   ‚îî‚îÄ View/
‚îú‚îÄ ConfigFiles/
‚îú‚îÄ index.php
‚îî‚îÄ vendor/
</code></pre>
      </div>
    </div>

    <!-- ========================= -->
    <!-- BOOTSTRAP -->
    <!-- ========================= -->
    <div class="card ombra mt-3" id="bootstrap">
      <div class="card-body">
        <h3>2) Bootstrap & Config</h3>
        <pre><code>Config::loadFromJson(__DIR__.'/ConfigFiles/config.local.json');
Config::runHooks();
</code></pre>
        <p class="mt-2">
          Il file <code>config.local.json</code> √® <b>obbligatorio</b>.
          Senza di esso il sistema entra in modalit√† installazione.
        </p>
      </div>
    </div>

    <!-- ========================= -->
    <!-- ROUTER -->
    <!-- ========================= -->
    <div class="card ombra mt-3" id="router">
      <div class="card-body">
        <h3>3) Router</h3>
        <p>Gestisce routing standard, API versionate e plugin.</p>
        <pre><code>controller/metodo/parametri
api/v1/controller/metodo
</code></pre>
      </div>
    </div>

    <!-- ========================= -->
    <!-- TWIG -->
    <!-- ========================= -->
    <div class="card ombra mt-3" id="twig">
      <div class="card-body">
        <h3>4) Twig & Template</h3>
        <pre><code>$twigManager->addFilter(
  'NumFormat',
  fn($n,$d=2)=>number_format($n,$d,',','.')
);
</code></pre>
      </div>
    </div>

    <!-- ========================= -->
    <!-- ASSETS -->
    <!-- ========================= -->
    <div class="card ombra mt-3" id="assets">
      <div class="card-body">
        <h3>5) Gestione Assets</h3>
        <pre><code>$this->addCss('/css/app.css','app-css');
$this->addJs('/js/app.js','app-js',['vendor']);
</code></pre>
      </div>
    </div>

    <!-- ========================= -->
    <!-- FORMHELPER -->
    <!-- ========================= -->
    <div class="card ombra mt-3" id="formhelper">
      <div class="card-body">
        <h3>6) FormHelper</h3>
        <p>Generazione centralizzata dei form con Bootstrap 5 e Select2.</p>
        <pre><code>FormHelper::field('nome',[
 'type'=>'text',
 'label'=>'Nome',
 'required'=>true
],$val);
</code></pre>
      </div>
    </div>

    <!-- ========================= -->
    <!-- AJAX -->
    <!-- ========================= -->
    <div class="card ombra mt-3" id="ajax">
      <div class="card-body">
        <h3>7) AJAX & Forms</h3>
        <pre><code>AjaxHelper.post('/api/v1/test',{id:1});</code></pre>
      </div>
    </div>

    <!-- ========================= -->
    <!-- PLUGIN -->
    <!-- ========================= -->
    <div class="card ombra mt-3" id="plugin">
      <div class="card-body">
        <h3>8) Plugin System</h3>
        <pre><code>$router->addPluginRoute('demo',function(){
  echo "Plugin OK";
});
</code></pre>
      </div>
    </div>

    <!-- ========================= -->
    <!-- UPDATE -->
    <!-- ========================= -->
    <div class="card ombra mt-3" id="update">
      <div class="card-body">
        <h3>9) Update & Backup</h3>
        <p>Sistema integrato con rollback automatico.</p>
      </div>
    </div>

    <!-- ========================= -->
    <!-- MIGRATIONS -->
    <!-- ========================= -->
    <div class="card ombra mt-3" id="migrations">
      <div class="card-body">
        <h3>10) Migrazioni DB</h3>
        <pre><code>php cli migrate
php cli rollback
</code></pre>
      </div>
    </div>

    <!-- ========================= -->
    <!-- INSTALLAZIONE -->
    <!-- ========================= -->
    <div class="card ombra mt-3" id="install">
      <div class="card-body">
        <h3>11) Installazione Sistema</h3>

        <p>
          Se il file <code>ConfigFiles/config.local.json</code> non esiste,
          il framework avvia automaticamente la procedura di installazione.
        </p>

        <pre><code>/install.php</code></pre>

        <ul>
          <li>Configurazione Database</li>
          <li>Configurazione Applicazione</li>
          <li>Header API personalizzati</li>
          <li>Generazione SALT e Link HTTPS</li>
        </ul>

        <div class="alert alert-warning mt-3">
          ‚ö†Ô∏è Rimuovere manualmente il file config forzer√† una nuova installazione.
        </div>
      </div>
    </div>

    <!-- ========================= -->
    <!-- EVENTI -->
    <!-- ========================= -->
    <div class="card ombra mt-3" id="eventi-core">
      <div class="card-body">
        <h3>12) Eventi Core</h3>
        <pre><code>EventManager::dispatch("controller.loaded",$class);
EventManager::dispatch("installazione.nuova",$msg);
</code></pre>
      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block Script %}{% endblock %}